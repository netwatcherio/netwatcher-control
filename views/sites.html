<div class="container-fluid">
    <div class="row">
        <!-- column -->
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <!-- title -->
                    <div class="d-md-flex">
                        <div>
                            <h4 class="card-title">sites</h4>
                            <h5 class="card-subtitle">an overview of the sites you have access to</h5>
                        </div>
                    </div>
                    <!-- title -->
                    <div class="table-responsive">
                        <div class="table-responsive mt-4">
                            <table class="
                        table
                        mb-0
                        text-nowrap
                        varient-table
                        align-middle
                        fs-3
                      " id="stats">
                                <thead>
                                <tr>
                                    <th class="px-0 text-muted" scope="col">name</th>
                                    <th class="px-0 text-muted" scope="col">agents</th>
                                    <th class="px-0 text-muted text-end" scope="col">view</th>
                                </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    let sites = JSON.parse("{{.sites}}")

    let parser = new DOMParser();

    let onlineCount = 0;
    let offlineCount = 0

    for (let i = 0; i < agents['list'].length; i++) {
        // Find a <table> element with id="myTable":
        let tbodyRef = document.getElementById('stats').getElementsByTagName('tbody')[0];

        let name = agents['list'][i]['name']
        let id = agents['list'][i]['id']
        let online = agents['list'][i]['online']
        let lastSeen = agents['list'][i]['last_seen']
        let netInfo = agents['list'][i]['network_info']
        let isp = netInfo['internet_provider']

        let date1 = new Date();
        let date2 = new Date(agents['list'][i]['heartbeat']);

        let onlineMsg = '<span class="badge bg-danger">' +
            '<i class="fa fa-arrow-down" ></i></span>'
        if (online) {
            onlineMsg = '<span class="badge bg-success">' +
                '<i class="fa fa-arrow-up" ></i></span>'
            onlineCount++
        }else{
            offlineCount++
        }

        // To calculate the time difference of two dates
        let Difference_In_Time = date2.getTime() - date1.getTime();

        // lol
        if (isp.toLowerCase().indexOf('shaw') !== -1){
            isp = '<i class="fa fa-thumbs-down"></i> '+isp
        }
        if (isp.toLowerCase().indexOf('telus') !== -1){
            isp = '<i class="fa fa-thumbs-up"></i> '+isp
        }

        // Insert a row at the end of table
        let newRow = tbodyRef.insertRow();
        // Insert a cell at the end of the row
        let newCell = newRow.insertCell();
        newCell.setAttribute("class", "px-0")
        newCell.innerHTML += onlineMsg
        newCell = newRow.insertCell();
        newCell.setAttribute("class", "px-0")
        newCell.innerHTML += name

        newCell = newRow.insertCell();
        newCell.setAttribute("class", "px-0")
        newCell.innerHTML += '<span class="badge bg-info">' + isp
            +'</span>'
        newCell = newRow.insertCell();
        newCell.setAttribute("class", "px-0 text-end")
        newCell.innerHTML += '<a href="/agent/'+id+'">' +
            '<span class="badge bg-purple">' +
            '<i class="fa fa-binoculars"></i> view</span></a>'
    }

    const ctx = document.getElementById('agentPie');
    // New chart
    new Chart(ctx, {
        type: "pie",
        data: {
            labels: ["Online", "Offline"],
            datasets: [
                {
                    label: "Agent Statuses",
                    backgroundColor: [
                        "#39CB7F",
                        "#FC4B6C",
                    ],
                    data: [onlineCount, offlineCount],
                },
            ],
        },
        options: {
            legend: {
                labels: {
                    fontColor: "#b2b9bf",
                },
            },
        },
        scales: {
            yAxes: [
                {
                    ticks: {
                        fontColor: "#b2b9bf",
                        fontSize: 12,
                    },
                },
            ],
            xAxes: [
                {
                    ticks: {
                        fontColor: "#b2b9bf",
                        fontSize: 12,
                    },
                },
            ],
        },
    });
</script>