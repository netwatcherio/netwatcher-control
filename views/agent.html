<div class="page-titles">
  <div class="row">
    <div class="col-lg-8 col-md-6 col-12 align-self-center">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb mb-0 d-flex align-items-center">
          <li class="breadcrumb-item">
            <a href="/home" class="link"><i class="ri-home-3-line fs-5"></i></a>
          </li>
          {{if .siteSelected}}
          <li class="breadcrumb-item">
            {{.siteName}}
          </li>
          {{end}}
          <li class="breadcrumb-item active" aria-current="page">
            {{.title}}
          </li>
        </ol>
      </nav>
      <h1 class="mb-0 fw-bold">{{.title}}</h1>
    </div>

    <div class="
                col-lg-4 col-md-6
                d-none d-md-flex
                align-items-center
                justify-content-end
              ">
      <a href="/icmp/{{.agentId}}" class="btn btn-info d-flex align-items-center ms-2">
        <i class="fa fa-globe"></i>
          view icmp
      </a>
      <a href="/iperf/{{.agentId}}" class="btn btn-info d-flex align-items-center ms-2">
        <i class="mdi mdi-lan-pending"></i>
          iperf
      </a>
      <a href="/iperf/{{.agentId}}" class="btn btn-info d-flex align-items-center ms-2">
        <i class="bi-file-bar-graph"></i>
          host stats
      </a>
    </div>

  </div>
</div>

<div class="container-fluid">
  <!-- Row -->
  <div class="row">
    <div class="col-lg-3 col-md-4">
      <div class="card border-bottom border-dark">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div>
              <h2>todo</h2>
              <!--TODO make change color depending on status-->
              <h6 class="text-dark mb-0">status</h6>
            </div>
            <div class="ms-auto">
              <span class="text-dark display-6">
                <i class="fa fa-xing"></i>
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-3 col-md-4">
      <div class="card border-bottom border-info">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div>
              <h2>{{.localAddress}}</h2>
              <h6 class="text-info mb-0">local ip</h6>
            </div>
            <div class="ms-auto">
              <span class="text-info display-6">
                <i class="fa fa-home"></i>
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-3 col-md-4">
      <div class="card border-bottom border-primary">
        <div class="card-body">
          <div class="d-flex no-block align-items-center">
            <div>
              <h2>{{.defaultGateway}}</h2>
              <h6 class="text-primary mb-0">default gateway</h6>
            </div>
            <div class="ms-auto">
              <span class="text-primary display-6">
                <i class="fa fa-compass"></i>
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-3 col-md-4">
      <div class="card border-bottom border-purple">
        <div class="card-body">
          <div class="d-flex no-block align-items-center">
            <div>
              <h2>{{.publicAddress}}</h2>
              <h6 class="text-purple mb-0">public ip</h6>
            </div>
            <div class="ms-auto">
              <span class="text-purple display-6">
                <i class="fa fa-globe"></i>
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="row">
  <div class="col-lg-4 col-md-6">
    <div class="card border-bottom border-orange">
      <div class="card-body">
        <div class="d-flex no-block align-items-center">
          <div>
            <h2>{{.internetProvider}}</h2>
            <h6 class="text-orange mb-0">isp</h6>
          </div>
          <div class="ms-auto">
              <span class="text-orange display-6">
                <i class="fa fa-compass"></i>
              </span>
          </div>
        </div>
      </div>
    </div>
  </div>
    <div class="col-lg-4 col-md-6">
      <div class="card border-bottom border-dark">
        <div class="card-body">
          <div class="d-flex no-block align-items-center">
            <div>
              <h2>{{.uploadSpeed}}mbps</h2>
              <h6 class="text-dark mb-0">upload speed</h6>
            </div>
            <div class="ms-auto">
              <span class="text-dark display-6">
                <i class="fa fa-upload"></i>
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-4 col-md-6">
      <div class="card border-bottom border-dark">
        <div class="card-body">
          <div class="d-flex no-block align-items-center">
            <div>
              <h2>{{.downloadSpeed}}mbps</h2>
              <h6 class="text-dark mb-0">download speed</h6>
            </div>
            <div class="ms-auto">
              <span class="text-dark display-6">
                <i class="fa fa-download"></i>
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-lg-4">
      <div class="card">
      <div class="card-body">
        <h4>recent traceroutes</h4>
        <h6 class="card-subtitle lh-base mb-0">
          view the most recent traceroutes from the agent
        </h6>
        <br>
        <div class="text-end">
        <a href="/traceroutes/{{.agentId}}">
          <button type="button" class="
                          btn
                          waves-effect waves-light
                          btn-light-info
                          text-info
                          font-weight-medium
                        ">
            <i class="mdi mdi-map"></i>
            view more
          </button>
        </a>
        </div>
        <br>
        <div class="table-responsive">
          <table class="table customize-table mb-0 v-middle text-nowrap" id="traceroutes">
            <thead class="table-light">
            <tr>
              <th class="border-bottom border-top">timestamp</th>
              <!--<th class="border-bottom border-top">triggered</th>-->
              <th class="border-bottom border-top text-end">view</th>
            </tr>
            </thead>
            <tbody>
            </tbody>
          </table>
        </div>
      </div>
      </div>
    </div>
    <div class="col-lg-8">
      <div class="card">
      <div class="card-body">
        <h4>recent speedtests</h4>
        <h6 class="card-subtitle lh-base mb-0">
          view the most recent speedtests from the agent
        </h6>
        <br>
        <div class="text-end">
          {{if .speedtestPending}}
          <button type="button" class="
                          btn
                          waves-effect waves-light
                          btn-light-warning
                          text-warning
                          font-weight-medium
                        ">
            <i class="mdi mdi-lan-pending"></i>
            already in queue
          </button>
          {{else}}
          <a href="/speedtest/{{.agentId}}/run">
            <button type="button" class="
                          btn
                          waves-effect waves-light
                          btn-light-info
                          text-info
                          font-weight-medium
                        ">
              <i class="mdi mdi-speedometer"></i>
              run speedtest
            </button>
          </a>
          {{end}}
        </div>
        <br>
        <div class="table-responsive">
          <table class="table customize-table mb-0 v-middle text-nowrap" id="speedtests">
            <thead class="table-light">
            <tr>
              <th class="border-bottom border-top">timestamp</th>
              <th class="border-bottom border-top">upload</th>
              <th class="border-bottom border-top">download</th>
              <th class="border-bottom border-top text-end">server</th>
            </tr>
            </thead>
            <tbody>
            </tbody>
          </table>
      </div>
      </div>
    </div>
  </div>


  <!-- Row -->
</div>

<script>
  let traceroutes = JSON.parse("{{.mtr}}")
  let speed = JSON.parse("{{.speed}}")

  let parser = new DOMParser();

  for (let i = 0; i < traceroutes.length; i++) {

/*    {
      "id": "632e3d6bf4992062743f749a",
            "agent": "632ddcce6097d9782e199900",
            "data": [
      {
        "address": "1.1.1.1",
        "result": {
          "triggered": false,
          "mtr": {
            "destination": "1.1.1.1",
    ],
    }*/

    // Find a <table> element with id="myTable":
    let tbodyRef = document.getElementById('traceroutes').getElementsByTagName('tbody')[0];

    let timestamp = traceroutes[i]['timestamp']
    let id = traceroutes[i]['id']

    // Insert a row at the end of table
    let newRow = tbodyRef.insertRow();
    // Insert a cell at the end of the row

    newCell = newRow.insertCell();
    newCell.setAttribute("class", "px-0")
    newCell.innerHTML += '<code>' + timestamp + '</code>'

    newCell = newRow.insertCell();
    newCell.setAttribute("class", "px-0 text-end")
    newCell.innerHTML += '<a href="/traceroute/'+id+'">' +
            '<span class="badge bg-purple">' +
            '<i class="fa fa-binoculars"></i> view</span></a>'
  }
  for (let i = 0; i < speed.length; i++) {

    // Find a <table> element with id="myTable":
    let tbodyRef = document.getElementById('speedtests').getElementsByTagName('tbody')[0];

    let timestamp = speed[i]['data']['timestamp']
    let dl_speed = speed[i]['data']['dl_speed']
    let ul_speed = speed[i]['data']['ul_speed']
    let server = speed[i]['data']['host']

    // Insert a row at the end of table
    let newRow = tbodyRef.insertRow();
    // Insert a cell at the end of the row

    newCell = newRow.insertCell();
    newCell.setAttribute("class", "px-0")
    newCell.innerHTML += '<code>' + timestamp + '</code>'

    newCell = newRow.insertCell();
    newCell.setAttribute("class", "px-0")
    newCell.innerHTML += Math.round(ul_speed) + 'mbps'

    newCell = newRow.insertCell();
    newCell.setAttribute("class", "px-0")
    newCell.innerHTML += Math.round(dl_speed) + 'mbps'

    newCell = newRow.insertCell();
    newCell.setAttribute("class", "px-0 text-end")
    newCell.innerHTML += '<code>' + server + '</code>'
  }

  /*const ctx = document.getElementById('agentPie');
  // New chart
  new Chart(ctx, {
      type: "pie",
      data: {
          labels: ["Online", "Offline"],
          datasets: [
              {
                  label: "Agent Statuses",
                  backgroundColor: [
                      "#39CB7F",
                      "#FC4B6C",
                  ],
                  data: [onlineCount, offlineCount],
              },
          ],
      },
      options: {
          legend: {
              labels: {
                  fontColor: "#b2b9bf",
              },
          },
      },
      scales: {
          yAxes: [
              {
                  ticks: {
                      fontColor: "#b2b9bf",
                      fontSize: 12,
                  },
              },
          ],
          xAxes: [
              {
                  ticks: {
                      fontColor: "#b2b9bf",
                      fontSize: 12,
                  },
              },
          ],
      },
  });*/
</script>