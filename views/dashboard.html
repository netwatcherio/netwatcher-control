<div class="container-fluid">
    <div class="row">
        <div class="col-lg-4">
            <div class="card">
                <div class="border-bottom title-part-padding">
                    <h4 class="mb-0">agent statuses</h4>
                </div>
                <div class="card-body">
                    <div>
                        <div class="chartjs-size-monitor"
                             style="position: absolute; inset: 0px; overflow: hidden; pointer-events: none; visibility: hidden; z-index: -1;">
                            <div class="chartjs-size-monitor-expand"
                                 style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1;">
                                <div style="position:absolute;width:1000000px;height:1000000px;left:0;top:0"></div>
                            </div>
                            <div class="chartjs-size-monitor-shrink"
                                 style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1;">
                                <div style="position:absolute;width:200%;height:200%;left:0; top:0"></div>
                            </div>
                        </div>
                        <canvas class="chartjs-render-monitor" height="213" id="agentPie"
                                style="display: block; width: 427px; height: 213px;"
                                width="427"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-8 d-flex align-items-stretch">
            <div class="card w-100">
                <div class="card-body">
                    <div class="d-md-flex align-items-center">
                        <div>
                            <h3 class="card-title">agent info</h3>
                            <h6 class="card-subtitle mb-0">
                                general agent information
                            </h6>
                        </div>
                    </div>
                    <div class="table-responsive mt-4">
                        <table class="
                        table
                        mb-0
                        text-nowrap
                        varient-table
                        align-middle
                        fs-3
                      " id="stats">
                            <thead>
                            <tr>
                                <th class="px-0 text-muted" scope="col">status</th>
                                <th class="px-0 text-muted" scope="col">name</th>
                                <th class="px-0 text-muted" scope="col">isp</th>
                                <th class="px-0 text-muted text-end" scope="col">view</th>
                            </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!--<script>


        // create the svg area
        var svg = d3.select("#my_dataviz")
            .append("svg")
            .attr("width", 440)
            .attr("height", 440)
            .append("g")
            .attr("transform", "translate(220,220)")

        // create a matrix
        var matrix = [
            [11,  58, 89, 28],
            [ 51, 18, 20, 61],
            [ 80, 145, 80, 85],
            [ 103,   99,  40, 71]
        ];

        // give this matrix to d3.chord(): it will calculates all the info we need to draw arc and ribbon
        var res = d3.chord()
            .padAngle(0.05)
            .sortSubgroups(d3.descending)
            (matrix)

        // Add the links between groups
        svg
            .datum(res)
            .append("g")
            .selectAll("path")
            .data(function(d) { return d; })
            .enter()
            .append("path")
            .attr("d", d3.ribbon()
                .radius(190)
            )
            .style("fill", "#69b3a2")
            .style("stroke", "black");

        // this group object use each group of the data.groups object
        var group = svg
            .datum(res)
            .append("g")
            .selectAll("g")
            .data(function(d) { return d.groups; })
            .enter()

        // add the group arcs on the outer part of the circle
        group.append("g")
            .append("path")
            .style("fill", "grey")
            .style("stroke", "black")
            .attr("d", d3.arc()
                .innerRadius(190)
                .outerRadius(200)
            )

        // Add the ticks
        group
            .selectAll(".group-tick")
            .data(function(d) { return groupTicks(d, 25); })    // Controls the number of ticks: one tick each 25 here.
            .enter()
            .append("g")
            .attr("transform", function(d) { return "rotate(" + (d.angle * 180 / Math.PI - 90) + ") translate(" + 200 + ",0)"; })
            .append("line")               // By default, x1 = y1 = y2 = 0, so no need to specify it.
            .attr("x2", 6)
            .attr("stroke", "black")

        // Add the labels of a few ticks:
        group
            .selectAll(".group-tick-label")
            .data(function(d) { return groupTicks(d, 25); })
            .enter()
            .filter(function(d) { return d.value % 25 === 0; })
            .append("g")
            .attr("transform", function(d) { return "rotate(" + (d.angle * 180 / Math.PI - 90) + ") translate(" + 200 + ",0)"; })
            .append("text")
            .attr("x", 8)
            .attr("dy", ".35em")
            .attr("transform", function(d) { return d.angle > Math.PI ? "rotate(180) translate(-16)" : null; })
            .style("text-anchor", function(d) { return d.angle > Math.PI ? "end" : null; })
            .text(function(d) { return d.value })
            .style("font-size", 9)


        // Returns an array of tick angles and values for a given group and step.
        function groupTicks(d, step) {
            var k = (d.endAngle - d.startAngle) / d.value;
            return d3.range(0, d.value, step).map(function(value) {
                return {value: value, angle: value * k + d.startAngle};
            });
        }

    </script>-->
</div>

<script>
    let agents = JSON.parse("{{.agents}}")

    let parser = new DOMParser();

    for (let i = 0; i < agents['list'].length; i++) {
        // Find a <table> element with id="myTable":
        let tbodyRef = document.getElementById('stats').getElementsByTagName('tbody')[0];

        let name = agents['list'][i]['name']
        let id = agents['list'][i]['id']
        let netInfo = agents['list'][i]['network_info']
        let isp = netInfo['internet_provider']

        let date1 = new Date();
        let date2 = new Date(agents['list'][i]['heartbeat']);

        // To calculate the time difference of two dates
        let Difference_In_Time = date2.getTime() - date1.getTime();

        // lol
        if (isp.toLowerCase().indexOf('shaw') !== -1){
            isp = '<i class="fa fa-thumbs-down"></i> '+isp
        }
        if (isp.toLowerCase().indexOf('telus') !== -1){
            isp = '<i class="fa fa-thumbs-up"></i> '+isp
        }

        // Insert a row at the end of table
        let newRow = tbodyRef.insertRow();
        // Insert a cell at the end of the row
        let newCell = newRow.insertCell();
        newCell.setAttribute("class", "px-0")
        newCell.innerHTML += '<span class="badge bg-success">' +
            '<i class="fa fa-check" > </i></span>'
        newCell = newRow.insertCell();
        newCell.setAttribute("class", "px-0")
        newCell.innerHTML += name

        newCell = newRow.insertCell();
        newCell.setAttribute("class", "px-0")
        newCell.innerHTML += '<span class="badge bg-info">' + isp
            +'</span>'
        newCell = newRow.insertCell();
        newCell.setAttribute("class", "px-0 text-end")
        newCell.innerHTML += '<a href="/agent/'+id+'">' +
            '<span class="badge bg-purple">' +
            '<i class="fa fa-binoculars"></i> view</span></a>'
    }

    const ctx = document.getElementById('agentPie');
    // New chart
    const statusPie = new Chart(ctx, {
        type: "pie",
        data: {
            labels: ["Online", "Offline"],
            datasets: [
                {
                    label: "Population (millions)",
                    backgroundColor: [
                        "#22bb33",
                        "#bb2124",
                    ],
                    data: [69, 420],
                },
            ],
        },
        options: {
            legend: {
                labels: {
                    fontColor: "#b2b9bf",
                },
            },
        },
        scales: {
            yAxes: [
                {
                    ticks: {
                        fontColor: "#b2b9bf",
                        fontSize: 12,
                    },
                },
            ],
            xAxes: [
                {
                    ticks: {
                        fontColor: "#b2b9bf",
                        fontSize: 12,
                    },
                },
            ],
        },
    });
</script>